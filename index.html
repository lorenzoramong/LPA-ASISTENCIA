<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LPA – Asistencia</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ef4444">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LPA Asistencia">
  <link rel="apple-touch-icon" href="app-icon.png.jpg">
</head>
<body class="bg-[#fdf6e3]">

  <!-- MODAL LOGIN -->
  <div id="login-modal" class="fixed inset-0 z-50">
    <div class="absolute inset-0 flex items-center justify-center">
      <div class="bg-white p-8 rounded-xl shadow-lg w-96 text-center">
        <!-- LOGO -->
        <div class="flex justify-center mb-6">
          <img src="app-icon2.png" alt="Logo LPA" class="w-32 h-32 object-contain">
        </div>

        <h2 class="text-2xl font-bold text-red-600 mb-6">Iniciar Sesión</h2>
        <form id="login-form" class="space-y-5">
          <div>
            <label class="block text-gray-700 text-left">Correo</label>
            <input type="email" id="login-email" required class="w-full px-3 py-2 border border-gray-300 rounded">
          </div>
          <div>
            <label class="block text-gray-700 text-left">Contraseña</label>
            <input type="password" id="login-password" required class="w-full px-3 py-2 border border-gray-300 rounded">
          </div>
          <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg">Entrar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- APP (oculto hasta iniciar sesión) -->
  <div id="app" class="max-w-3xl mx-auto p-4 hidden">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-red-600">LPA – Asistencia</h1>
      <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">Salir</button>
    </div>

    <!-- Tabs -->
    <div class="flex space-x-2 mb-4">
      <button class="tab-button active bg-red-500 text-white px-4 py-2 rounded" data-tab="asistencia-tab">Registro de Asistencia</button>
      <button class="tab-button bg-gray-200 px-4 py-2 rounded" data-tab="jugadores-tab">Jugadores</button>
    </div>

    <!-- TAB: Asistencia -->
    <div id="asistencia-tab" class="tab-content">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Registro de Asistencia</h2>
        <form id="asistencia-form" class="flex flex-col md:flex-row md:space-x-2 space-y-2 md:space-y-0">
          <select id="player-select" class="flex-1 px-3 py-2 border rounded" required>
            <option value="">Seleccionar jugador</option>
          </select>
          <input type="date" id="fecha" class="px-3 py-2 border rounded" required>
          <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Registrar</button>
        </form>
      </div>

      <div class="bg-white p-6 rounded shadow mt-6">
        <h2 class="text-xl font-bold mb-4">Historial de Asistencia</h2>
        <table class="w-full border">
          <thead>
            <tr class="bg-gray-200">
              <th class="border px-2 py-1">Jugador</th>
              <th class="border px-2 py-1">Fecha</th>
              <th class="border px-2 py-1">Acciones</th>
            </tr>
          </thead>
          <tbody id="asistencia-list"></tbody>
        </table>
      </div>
    </div>

    <!-- TAB: Jugadores -->
    <div id="jugadores-tab" class="tab-content hidden">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Agregar Jugador</h2>
        <form id="jugador-form" class="flex space-x-2">
          <input type="text" id="jugador-nombre" placeholder="Nombre" class="flex-1 px-3 py-2 border rounded" required>
          <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Agregar</button>
        </form>
      </div>

      <div class="bg-white p-6 rounded shadow mt-6">
        <h2 class="text-xl font-bold mb-4">Lista de Jugadores</h2>
        <table class="w-full border">
          <thead>
            <tr class="bg-gray-200">
              <th class="border px-2 py-1">Nombre</th>
              <th class="border px-2 py-1">Acciones</th>
            </tr>
          </thead>
          <tbody id="jugadores-list"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Firebase y lógica -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      projectId: "TU_PROJECT_ID",
      storageBucket: "TU_STORAGE_BUCKET",
      messagingSenderId: "TU_SENDER_ID",
      appId: "TU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Login
    const loginForm = document.getElementById("login-form");
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        document.getElementById("login-modal").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        cargarJugadores();
        cargarAsistencia();
      } catch (error) {
        alert("Error al iniciar sesión: " + error.message);
      }
    });

    // Logout
    document.getElementById("logout-btn").addEventListener("click", async () => {
      await signOut(auth);
      document.getElementById("login-modal").classList.remove("hidden");
      document.getElementById("app").classList.add("hidden");
    });

    // Tabs
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabContents = document.querySelectorAll(".tab-content");

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        tabButtons.forEach((b) => b.classList.remove("bg-red-500", "text-white", "active"));
        btn.classList.add("bg-red-500", "text-white", "active");
        const tab = btn.getAttribute("data-tab");
        tabContents.forEach((content) => {
          content.classList.add("hidden");
          if (content.id === tab) content.classList.remove("hidden");
        });
      });
    });

    // Firestore - Jugadores
    const jugadorForm = document.getElementById("jugador-form");
    jugadorForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nombre = document.getElementById("jugador-nombre").value;
      try {
        await addDoc(collection(db, "jugadores"), { nombre });
        document.getElementById("jugador-nombre").value = "";
        cargarJugadores();
      } catch (error) {
        alert("Error al agregar jugador: " + error.message);
      }
    });

    async function cargarJugadores() {
      const jugadoresList = document.getElementById("jugadores-list");
      const playerSelect = document.getElementById("player-select");
      jugadoresList.innerHTML = "";
      playerSelect.innerHTML = '<option value="">Seleccionar jugador</option>';

      const querySnapshot = await getDocs(collection(db, "jugadores"));
      querySnapshot.forEach((docSnap) => {
        const jugador = docSnap.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="border px-2 py-1">${jugador.nombre}</td>
          <td class="border px-2 py-1">
            <button class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm" onclick="eliminarJugador('${docSnap.id}')">Eliminar</button>
          </td>
        `;
        jugadoresList.appendChild(row);

        const option = document.createElement("option");
        option.value = docSnap.id;
        option.textContent = jugador.nombre;
        playerSelect.appendChild(option);
      });
    }

    async function eliminarJugador(id) {
      await deleteDoc(doc(db, "jugadores", id));
      cargarJugadores();
    }
    window.eliminarJugador = eliminarJugador;

    // Firestore - Asistencia
    const asistenciaForm = document.getElementById("asistencia-form");
    asistenciaForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const jugadorId = document.getElementById("player-select").value;
      const fecha = document.getElementById("fecha").value;
      if (!jugadorId) return alert("Selecciona un jugador");
      try {
        await addDoc(collection(db, "asistencia"), { jugadorId, fecha });
        cargarAsistencia();
      } catch (error) {
        alert("Error al registrar asistencia: " + error.message);
      }
    });

    async function cargarAsistencia() {
      const asistenciaList = document.getElementById("asistencia-list");
      asistenciaList.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "asistencia"));
      querySnapshot.forEach((docSnap) => {
        const asistencia = docSnap.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="border px-2 py-1">${asistencia.jugadorId}</td>
          <td class="border px-2 py-1">${asistencia.fecha}</td>
          <td class="border px-2 py-1">
            <button class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm" onclick="eliminarAsistencia('${docSnap.id}')">Eliminar</button>
          </td>
        `;
        asistenciaList.appendChild(row);
      });
    }

    async function eliminarAsistencia(id) {
      await deleteDoc(doc(db, "asistencia", id));
      cargarAsistencia();
    }
    window.eliminarAsistencia = eliminarAsistencia;
  </script>
</body>
</html>































